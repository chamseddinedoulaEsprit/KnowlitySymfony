{% extends 'base.html.twig' %}

{% block title %}Nouvelle Réponse{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"> 
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ asset('assets/css/newreponse.css') }}">
    <style>
        .warning-message {
            display: none;
            color: #dc3545;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .code-block {
            margin: 15px 0;
            border-radius: 4px;
            background: #272822;
        }
        .language-label {
            background-color: #3c3c3c;
            color: #fff;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 0.8em;
            display: inline-block;
            margin-bottom: 5px;
        }
        pre {
            margin: 0 !important;
            padding: 15px !important;
            border-radius: 4px;
            background: #272822 !important;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="form-container">
        <h2>Répondre à la question</h2>
        
        <div class="question-details">
            <h4>{{ question.title }}</h4>
            <p>{{ question.enonce }}</p>
            
            {% if question.codeSnippet %}
                <div class="code-block">
                    <span class="language-label">{{ question.programmingLanguage|upper }}</span>
                    <pre><code class="language-{{ question.programmingLanguage }}">{{ question.codeSnippet }}</code></pre>
                </div>
            {% endif %}
        </div>

        {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate', 'id': 'reponse-form'}}) }}
        
            <div class="mb-3">
                {{ form_label(form.text, 'Votre réponse', {'class': 'form-label'}) }}
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text"><i class="fas fa-edit"></i></span>
                    </div>
                    {{ form_widget(form.text, {'attr': {'class': 'form-control', 'id': 'reponse-text'}}) }}
                </div>
                <div class="warning-message" id="profanity-warning">
                    <i class="fas fa-exclamation-triangle"></i> Attention : Votre réponse pourrait contenir du contenu inapproprié.
                </div>
                {{ form_errors(form.text) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.is_correct, 'Réponse correcte?', {'class': 'form-label'}) }}
                <div class="input-group">
                    {{ form_widget(form.is_correct, {'attr': {'class': 'form-check-input'}}) }}
                </div>
                {{ form_errors(form.is_correct) }}
            </div>

            <button type="submit" class="btn btn-success" id="submit-btn">
                <i class="fas fa-check-circle icon-btn"></i>Soumettre la réponse
            </button>

            <a href="{{ path('app_question_index') }}" class="btn btn-secondary">
                <i class="fas fa-times-circle icon-btn"></i>Annuler
            </a>
            
        {{ form_end(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-html.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight all code blocks
            Prism.highlightAll();

            const reponseText = document.getElementById('reponse-text');
            const warningMessage = document.getElementById('profanity-warning');
            let typingTimer;

            reponseText.addEventListener('input', function() {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(function() {
                    checkProfanity(reponseText.value);
                }, 500);
            });

            function checkProfanity(text) {
                fetch(`/api/check-profanity?text=${encodeURIComponent(text)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.containsProfanity) {
                            warningMessage.style.display = 'block';
                        } else {
                            warningMessage.style.display = 'none';
                        }
                    });
            }
        });
    </script>
{% endblock %}