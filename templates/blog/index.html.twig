{% extends 'base2.html.twig' %}

{% block title %}Blog index{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .blog-image-container {
            height: 300px;
            overflow: hidden;
            background-color: #f8f9fa;
        }

        .blog-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: transform 0.3s ease;
        }

        .blog-image-placeholder {
            height: 100%;
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .blog-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }

        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .blog-card:hover .blog-image-container img {
            transform: scale(1.05);
        }
    </style>
{% endblock %}

{% block body %}
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">Blogs</h1>
                </div>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="container-fluid">
            <!-- Barre de recherche -->
            

            <!-- Liste des blogs -->
            {% if blogs|length == 0 %}
                <div class="card">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-blog fa-4x text-muted mb-3"></i>
                        <h3>Aucun blog pour le moment</h3>
                        <p class="text-muted">Soyez le premier à créer un article !</p>
                        <a href="{{ path('app_blog_new') }}" class="btn btn-primary mt-3">
                            <i class="fas fa-plus mr-2"></i>Créer un article
                        </a>
                    </div>
                </div>
            {% else %}
                {% for blog in blogs %}
                    <div class="card mb-4 blog-card">
                        <div class="row no-gutters">
                            <!-- Image du blog -->
                            <div class="col-md-4 blog-image-container">
{% if blog.blogImage %}
            <div class="blog-image-container animate__animated animate__fadeInUp">
                <img src="{{ asset('uploads/images/' ~ blog.blogImage) }}" class="blog-image" alt="Image principale du blog">
            </div>
        {% endif %}
                            </div>
                            <!-- Contenu du blog -->
                            <div class="col-md-8">
                                <div class="card-body d-flex flex-column h-100">
                                    <div>
                                        <div class="blog-meta text-muted mb-2">
                                            <small>
                                                <i class="fas fa-user mr-2"></i>{{ blog.creatorName }}
                                                <span class="mx-2">•</span>
                                                <i class="fas fa-calendar-alt mr-2"></i>{{ blog.createdAt ? blog.createdAt|date('d/m/Y') : '' }}
                                            </small>
                                        </div>
                                        <h5 class="card-title blog-title">{{ blog.title }}</h5>
                                        <p class="card-text blog-excerpt">{{ blog.content|striptags|slice(0, 200) }}...</p>

                                        <div class="blog-meta text-muted mb-3">
                                            <small>
                                                <i class="fas fa-heart text-danger"></i>
            <span class="likes-count">{{ blog.getLikesCount() }}</span>
                                                <i class="fas fa-comments text-primary"></i>
                                                <span>{{ blog.comments|length }}</span>
                                            </small>
                                        </div>

                                        <div class="mt-auto">
                                            <div class="btn-group">
                                                <a href="{{ path('app_blog_show', {'id': blog.id}) }}" class="btn btn-primary">
                                                    <i class="fas fa-eye mr-2"></i>Lire l'article
                                                </a>
                                                <a href="{{ path('app_blog_edit', {'id': blog.id}) }}" class="btn btn-outline-secondary">
                                                    <i class="fas fa-edit mr-2"></i>Modifier
                                                </a>
                                                <form action="{{ path('app_blog_delete', {'id': blog.id}) }}" method="POST" class="d-inline">
                                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ blog.id) }}">
                                                    <button type="submit" class="btn btn-outline-danger" onclick="return confirm('Êtes-vous sûr de vouloir supprimer cet article ?');">
                                                        <i class="fas fa-trash mr-2"></i>Supprimer
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}

                <!-- Pagination -->
                <div class="d-flex justify-content-center">
                    {{ knp_pagination_render(blogs) }}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Bouton flottant pour créer un blog -->
    <a href="{{ path('app_blog_new') }}" class="btn btn-primary btn-circle btn-lg position-fixed" style="bottom: 30px; right: 30px;">
        <i class="fas fa-plus"></i>
    </a>

    <style>
        .blog-card {
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }

        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .blog-image-container {
            height: 250px;
            overflow: hidden;
        }

        .blog-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .blog-image-placeholder {
            height: 100%;
            background-color: #f8f9fa;
        }

        .blog-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 1rem;
        }

        .blog-excerpt {
            color: #6c757d;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .btn-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .btn-circle:hover {
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }

        .pagination {
            margin: 2rem 0;
        }

        .pagination .page-link {
            border-radius: 50%;
            margin: 0 3px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .blog-meta {
            font-size: 0.9rem;
        }
    </style>
    
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/blog-search.js') }}"></script>
{% endblock %}