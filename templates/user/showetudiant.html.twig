{% extends 'base2.html.twig' %}
{% block body%}
<h2 class="text-center ">Liste des Etudiants</h2>
<div class="button-container">
    <button class="export-btn-blue" onclick="exportToExcel()">  
        üìä <span>Export to Excel</span>  
    </button>
    &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;  &nbsp;&nbsp;
        <button class="export-btn-pdf" onclick="exportToPDF()">  
        üìÑ Export to PDF  
    </button>
</div>
<br>

    <div class="position-relative w-75 mx-auto animated slideInDown">
        <input type="search" id="myInput" class="form-control border-0 rounded-pill w-100 py-3 ps-4 pe-5"
          placeholder="Search User" />
      </div>
<div class="mb-3">
        <a href="/user/back/createetudiant" class="btn btn-success">Nouveau Etudiant</a>
    </div>

  <br>
        <table class="table table-dark table-hover" id="myTable">
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Prenom</th>
                    <th>Numero Telephone</th>
                    <th>Localisation</th>
                    <th>Email</th>
                    <th>Image</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
             {% for us in user %}
                <tr>
<td>{{ us.nom }}</td>
<td>{{ us.prenom }}</td>
<td>{{ us.getNumTelephone() }}</td>
<td>{{ us.localisation }}</td>
<td>{{ us.email }}</td>
<td>   <img class="rounded-circle me-lg-2" src="{{ asset('uploads/' ~ us.getImage()) }}" alt="Image"></td>
<td> <a class="" href="/user/back/{{us.id}}/corbeille/etudiant">   <span class="action-btn trash"><i class="bi bi-trash-fill"></i></span> </a>
 &nbsp;&nbsp;&nbsp; <a href="/user/back/{{us.id}}/one_etudiant"> 
                        <span class="action-btn eye"><i class="bi bi-eye-fill"></i></span> </a>
                          </td>
{%endfor%}

</table>
<br>

      {% if app.request.pathinfo == '/user/showall/etudiant' %}
 <form method="post" action="{{ path('back_user_etudiant') }}">
    <div class="form d-flex align-items-center">
        <label for="num_pagination" class="form-label mb-0 me-2">Choose pagination</label>
        <input type="number" name="nombre_pagination" id="num_pagination" class="form-control form-control-sm me-2" required>
        <button type="submit" class="btn btn-primary btn-sm">Valider</button>
      

        
    </div>
</form>
  

       <br><br>
   <a href="/user/back/deletedetudiant" class="" style="color: red; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center;">

    <i class="bi bi-trash" style="font-size: 60px; color: red;"></i>
    
    Corbeille
</a>


      {%  else  %}
        <div class="pagination">
   
    {% if page > 1 %}
        <a href="{{ path('back_user_etudiant', {'page': page - 1}) }}" class="prev-page">
            <i class="fas fa-arrow-left"></i> 
        </a>
    {% endif %}

   {% if pages>1 %}
    <span class="page-number">
        Page {{ page }} sur {{ pages }}
    </span>
  {% endif%}
    {% if page < pages %}
        <a href="{{ path('back_user_etudiant', {'page': page + 1}) }}" class="next-page">
            <i class="fas fa-arrow-right"></i> 
        </a>
    {% endif %}
   
</div>
 <br>
 <br>
 
 <a href="{{ path('showalletudiant') }}">Show All</a>

        <br><br>
   <a href="/user/back/deletedetudiant" class="" style="color: red; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center;">

    <i class="bi bi-trash" style="font-size: 60px; color: red;"></i>
    
    Corbeille
</a>



{% endif %}











































<br>
<br>

 

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#myInput").on("keyup", function () {
          var value = $(this).val().toLowerCase();
          var visibleRows = 0;

          $("#myTable tbody tr").each(function () {
            if ($(this).text().toLowerCase().indexOf(value) > -1) {
              $(this).show();
              visibleRows++;
            } else {
              $(this).hide();
            }
          });

          // Afficher le message "Aucun r√©sultat" si n√©cessaire
          if (visibleRows === 0) {
            $("#noResults").show();
          } else {
            $("#noResults").hide();
          }
        });
      });
    </script>

<style>
.rounded-circle {
    width: 60px;
    height: 6%;
    border-radius: 50%; /* Cela rend l'image circulaire */
    object-fit: cover;  /* Cela permet √† l'image de garder une bonne proportion sans d√©former l'image */
}


 .button-container {
        display: flex;
        justify-content: center; /* Centre le bouton horizontalement */
        align-items: center;
        width: 100%;
        margin-top: 20px; /* Ajuste l'espacement si n√©cessaire */
    }

    .export-btn-blue {
        background-color: #007bff; /* Bleu √©clatant */
        color: gold;
        font-size: 16px;
        font-weight: bold;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
    }

    .export-btn-blue span {
        color: gold; /* Texte en or */
    }

    .export-btn-blue:hover {
        background-color: #0056b3; /* Bleu plus fonc√© au survol */
        box-shadow: 0 6px 12px rgba(0, 123, 255, 0.6);
        transform: scale(1.05);
    }
    
        
      .button-container {
        display: flex;
        justify-content: center; /* Centre le bouton horizontalement */
        align-items: center;
        width: 100%;
        margin-top: 20px; /* Ajuste l'espacement si n√©cessaire */
    }

    .export-btn-pdf {
        background-color: #dc3545; /* Rouge vif pour PDF */
        color: white;
        font-size: 16px;
        font-weight: bold;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 4px 10px rgba(220, 53, 69, 0.4);
    }

    .export-btn-pdf:hover {
        background-color: #c82333; /* Rouge plus fonc√© au survol */
        box-shadow: 0 6px 12px rgba(220, 53, 69, 0.6);
        transform: scale(1.05);
    }

.pagination {
    display: flex;
    justify-content: space-between;  /* Espacement √©gal entre les fl√®ches et le num√©ro de page */
    align-items: center;             /* Centrage vertical */
    margin-top: 20px;
}
.form {
    margin-bottom: 10px; /* Espacement entre les champs */
}

label.form-label {
    font-size: 14px; /* Taille du texte du label */
    font-weight: bold; /* Mise en gras du texte du label */
}


#num_pagination {
    width: 80px; /* Ajuste la largeur de l'input */
}

button.btn-sm {
    padding: 5px 10px; /* Ajuste la taille du bouton */
}

.pagination a {
    color: #007bff;
    font-size: 18px;
    padding: 10px;
    text-decoration: none;
}

.pagination a:hover {
    color: #0056b3;
}

.pagination a i {
    font-size: 20px;
}

.pagination .prev-page {
    margin-right: 20px;
}

.pagination .next-page {
    margin-left: 20px;
}

.pagination .page-number {
    font-size: 18px;
    text-align: center;
    font-weight: bold;
}

/* Optionnel : Si vous voulez ajouter un style particulier lorsque vous √™tes sur la premi√®re ou derni√®re page */
.pagination .prev-page:disabled,
.pagination .next-page:disabled {
    color: #ccc;
    cursor: not-allowed;
}

</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>

<script>
  function exportToExcel() {
    var table = document.getElementById('myTable');
    if (!table) {
      console.error("Table not found.");
      return;
    }

    // Trouver dynamiquement les indices des colonnes "Actions" et "Image"
    var columnsToRemove = [];
    var headerCells = table.rows[0].cells;

    for (var i = 0; i < headerCells.length; i++) {
      var colName = headerCells[i].innerText.trim().toLowerCase();
      if (colName === "actions" || colName === "image") {
        columnsToRemove.push(i);
      }
    }

    if (columnsToRemove.length === 0) {
      console.error("Colonnes √† exclure non trouv√©es.");
      return;
    }

    // Cr√©er une copie du tableau sans les colonnes "Actions" et "Image"
    var clonedTable = table.cloneNode(true);

    for (var i = 0; i < clonedTable.rows.length; i++) {
      // Supprimer les colonnes en partant de la plus grande index√©e pour √©viter les d√©calages
      columnsToRemove.sort((a, b) => b - a).forEach(index => {
        if (clonedTable.rows[i].cells.length > index) {
          clonedTable.rows[i].deleteCell(index);
        }
      });
    }

    // Convertir la copie en fichier Excel
    var workbook = XLSX.utils.table_to_book(clonedTable, { sheet: "Sheet1" });

    // Sauvegarder le fichier Excel
    XLSX.writeFile(workbook, 'table.xlsx');
  }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<script>
  function exportToPDF() {
    var table = document.getElementById('myTable');
    if (!table) {
      console.error("Table not found.");
      return;
    }

    // Trouver les indices des colonnes √† exclure
    var columnsToRemove = [];
    var headerCells = table.rows[0].cells;

    for (var i = 0; i < headerCells.length; i++) {
      var colName = headerCells[i].innerText.trim().toLowerCase();
      if (colName === "actions" || colName === "image") {
        columnsToRemove.push(i);
      }
    }

    if (columnsToRemove.length === 0) {
      console.error("Colonnes √† exclure non trouv√©es.");
      return;
    }

    // Initialiser jsPDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Ajouter le titre "Liste des Utilisateurs"
    doc.setFont("helvetica", "bold"); // Police en gras
    doc.setFontSize(16);
    doc.text("Liste des Utilisateurs", doc.internal.pageSize.width / 2, 15, { align: "center" });

    // Extraire les donn√©es du tableau
    var data = [];
    var headers = [];

    // R√©cup√©rer les en-t√™tes en excluant les colonnes sp√©cifi√©es
    for (var i = 0; i < headerCells.length; i++) {
      if (!columnsToRemove.includes(i)) {
        headers.push(headerCells[i].innerText.trim());
      }
    }

    // R√©cup√©rer les donn√©es des lignes
    for (var i = 1; i < table.rows.length; i++) {
      var row = [];
      for (var j = 0; j < table.rows[i].cells.length; j++) {
        if (!columnsToRemove.includes(j)) {
          row.push(table.rows[i].cells[j].innerText.trim());
        }
      }
      data.push(row);
    }

    // G√©n√©rer le tableau dans le PDF avec un espace sous le titre
    doc.autoTable({
      head: [headers],
      body: data,
      startY: 25, // D√©calage sous le titre
      styles: { fontSize: 10 },
      headStyles: { fillColor: [0, 123, 255] } // Bleu pour l'en-t√™te
    });

    // T√©l√©charger le PDF
    doc.save('Liste_Utilisateurs.pdf');
  }
</script>

{% endblock%}