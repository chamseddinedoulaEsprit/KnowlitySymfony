<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>R√©sultats d'√âvaluation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            color: #2c3e50;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 20px;
            color: #2980b9;
        }
        .student-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .evaluation-info {
            margin-bottom: 30px;
        }
        .question {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .response {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        .score {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }
        .total-score {
            text-align: right;
            font-size: 1.2em;
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f9ff;
            border-radius: 10px;
            border: 2px solid #3498db;
        }
        .badge-section {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            border-radius: 15px;
            background: linear-gradient(145deg, #f9f9f9, #ffffff);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .badge-section.gold {
            background: linear-gradient(145deg, #fff8e5, #fffdf0);
            border: 3px solid #ffd700;
        }
        .badge-section.silver {
            background: linear-gradient(145deg, #f5f5f5, #ffffff);
            border: 3px solid #c0c0c0;
        }
        .badge-icon {
            font-size: 72px;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }
        .badge-title {
            color: #2c3e50;
            font-size: 28px;
            margin: 15px 0;
            font-weight: bold;
        }
        .badge-message {
            font-style: italic;
            color: #666;
            margin: 15px 0;
            font-size: 1.1em;
            line-height: 1.6;
        }
        .warning-box {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .profanity-warning {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #ffebee;
            color: #c62828;
            text-align: center;
            padding: 15px;
            margin-top: 30px;
            border-top: 4px solid #c62828;
            font-weight: bold;
            font-size: 1.2em;
        }
        .profanity-warning i {
            color: #c62828;
            margin-right: 10px;
        }
        .success-message {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background-color: #d4edda;
            border-radius: 10px;
            color: #155724;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>R√©sultats d'√âvaluation</h1>
        <p>{{ evaluation.title }}</p>
        <p>Date: {{ "now"|date('d/m/Y') }}</p>
    </div>

    <div class="student-info">
        <h3>Informations de l'√©tudiant</h3>
        <p><strong>Nom:</strong> {{ student.nom }}</p>
        <p><strong>Pr√©nom:</strong> {{ student.prenom }}</p>
        <p><strong>Email:</strong> {{ student.email }}</p>
    </div>

    <div class="evaluation-info">
        <h3>Description de l'√©valuation</h3>
        <p>{{ evaluation.description }}</p>
        {% if evaluation.deadline %}
            <p><strong>Date limite :</strong> {{ evaluation.deadline|date('d/m/Y H:i') }}</p>
        {% endif %}

        <h3>R√©ponses et Notes</h3>
        {% for response in responses %}
            <div class="question">
                <p><strong>Question {{ loop.index }}:</strong> {{ response.question.enonce }}</p>
                <div class="response">
                    <p>Votre r√©ponse: {{ response.text }}</p>
                    {% if response.note == 0 and response.commentaire starts with 'AVERTISSEMENT' %}
                        <div class="warning-box">
                            <p><strong>Avertissement :</strong> {{ response.commentaire[13:] }}</p>
                        </div>
                    {% endif %}
                    <p class="score">Note: {{ response.note }}/{{ response.question.point }}</p>
                    {% if response.commentaire and not response.commentaire starts with 'AVERTISSEMENT' %}
                        <p><em>Commentaire : {{ response.commentaire }}</em></p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}

        <div class="total-score">
            <h3>Note Totale: {{ totalScore }}/{{ maxScore }}</h3>
        </div>

        {% if not hasProfanity %}
            {% if evaluation.badgeThreshold and totalScore >= evaluation.badgeThreshold %}
                <div class="badge-section {% if totalScore == maxScore %}gold{% else %}silver{% endif %}">
                    <h2>üéâ F√©licitations ! üéâ</h2>
                    <div class="badge-icon">
                        {{ evaluation.badgeImage|default('üèÜ') }}
                    </div>
                    <div class="badge-title">
                        {{ evaluation.badgeTitle|default('Badge de R√©ussite') }}
                    </div>
                    <p class="badge-message">
                        {% if totalScore == maxScore %}
                            Bravo ! Vous avez atteint la perfection dans cette √©valuation. Votre engagement et votre excellence sont vraiment remarquables. Continuez sur cette voie brillante !
                        {% else %}
                            F√©licitations pour cette belle r√©ussite ! Votre travail acharn√© et votre pers√©v√©rance ont port√© leurs fruits. Vous avez d√©montr√© une excellente ma√Ætrise du sujet.
                        {% endif %}
                    </p>
                    <p>Obtenu le {{ "now"|date('d/m/Y') }}</p>
                    <p>Pour avoir obtenu un score de {{ totalScore }} points sur {{ maxScore }}</p>
                </div>
            {% endif %}
        {% endif %}

        {% if hasProfanity %}
            <div class="profanity-warning">
                <i>‚ö†Ô∏è</i> AVERTISSEMENT : Du contenu inappropri√© a √©t√© d√©tect√© dans vos r√©ponses. 
                Cela peut affecter votre √©valuation et des mesures disciplinaires peuvent √™tre prises.
                <br>
                Veuillez maintenir un langage professionnel et respectueux dans toutes vos r√©ponses.
            </div>
        {% else %}
            <div class="success-message">
                <p>üåü Bravo pour votre participation ! üåü</p>
                <p>Continuez vos efforts, chaque √©valuation est une opportunit√© d'apprentissage.</p>
            </div>
        {% endif %}
    </div>
</body>
</html>